<%= javascript_include_tag 'restaurants/index' %>

<%= stylesheet_link_tag "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" %>
<p class="alert alert-success hide", id="feedback-info">
  Feedback has been saved successfully!
</p>
<% review = @reviews%>
<% @restaurant.each_with_index do |restaurant, i| %>
    <div class="container" xmlns="http://www.w3.org/1999/html">
      <div class="ResTitle">
        <%= render :partial => 'restaurant_basic_info', :locals => {:restaurant => restaurant, :i => i} %>
        <%- id_name = "toggle"+ i.to_s%>
        <% location = restaurant[:name].tr(" ", "+") + "," + restaurant[:address].tr(" ", "+")
           address = 'https://www.google.com/maps/embed/v1/place?key=AIzaSyC1crIIEC4So_FjEGhQ2QX1W9dc7eeM2Ds&q=' + location%>
        <button type="button" class="mybtn collapsed" data-toggle="collapse" data-target=<%="##{id_name}"%>></button>
        <div id= <%="#{id_name}"%>  class="collapse">
          <div class = "map">
              <iframe
              width="300"
              height="300"
              frameborder="0" style="border:0"
              src=<%="#{address}"%> allowfullscreen>
              </iframe>
          </div>
          <div class="detail_section">
          <h3>Other Details</h3>
          <% if @preference['discount'] %>
            Discount : <%= restaurant[:discount] %><br/>
          <% end %>
          <% if @preference['popular'] %>
            Popular times: <%= restaurant[:popular_times] %>
          <% end %>
          <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
            <div style="text-align: center"> <%= link_to "Make a Review", new_restaurant_review_path(restaurant), class: "btn btn-lg btn-primary", style:"background-color:  #B00100; border: none" %></div>
          </div>
          <div class="reviews">
            <div>
              <div style="background-color:#B00100; color:#ffffff; height:25px;"><h3>Reviews</h3></div>
            </div>
            <div class="reviewcontainer" >
              <% @reviewurl%>
              <table>
                <%review.each do |review|%>
                    <%if review.restaurant_id == restaurant.id then %>
                      <% user = review.user_name;  userrating = review.rating;  userreview = review.text;  reviewurl = review.review_url%>
                      <tr>
                        <td style="padding-right:20px;"><%= user%></td>
                        <td style="padding-top: 10px;">
                          <span class=<%if userrating >= 1 %> "fa fa-star checked" <%else%>"fa fa-star"<%end%>></span>
                          <span class=<%if userrating >= 2 %> "fa fa-star checked" <%else%>"fa fa-star"<%end%>></span>
                          <span class=<%if userrating >= 3 %> "fa fa-star checked" <%else%>"fa fa-star"<%end%>></span>
                          <span class=<%if userrating >= 4 %> "fa fa-star checked" <%else%>"fa fa-star"<%end%>></span>
                          <span class=<%if userrating >= 5 %> "fa fa-star checked" <%else%>"fa fa-star"<%end%>></span></br>
                          <%= userreview%><%= link_to "show more", reviewurl, target: :_blank%></td>
                      </tr>
                    <%end%>
                <%end%>
              </table>
              <div style="text-align: center"><%=link_to "See more on Yelp", restaurant[:url], {:target => "_blank"} %></div>
            </div>
          </div>
         </div>
      </div>
    </div>

<%end%>
<hr/>
<%= render :partial => 'footer_button_group' %>
